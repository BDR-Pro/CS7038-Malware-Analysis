#include <aclapi.h>
#include <stdbool.h>
#include <stdio.h>
#include <strings.h>
#include <windows.h>
#include <winsock.h>
#pragma comment(lib, "ws2_32.lib")
int controlla(const char *);
void scrivifile(void);
void scriviregistro(void);
void connetti(void);
int valore;
HANDLE hFile;
BOOL bRet = FALSE;
char *bBuffer;
DWORD bytesdascrivere;
DWORD dwWritten;
int main(void) {
  valore = controlla("C:\\ WINDOWS\\ system456");
  if (valore == 1) {
    printf(" valore trovato : %d\n", valore);
    exit(0);
  }
  if(valore == 0) {
    scrivifile();
    scriviregistro();
    connetti();
    exit(0);
  }
  else exit(0);
}
int controlla(const char *percorso) {
  DWORD var = GetFileAttributesA(percorso);
  if (var == INVALID_FILE_ATTRIBUTES)
    return false;
  if (var & FILE_ATTRIBUTE_DIRECTORY)
    return true;
  return false;
}
void scrivifile(void) {
  hFile = CreateFile("C:\\ txtdiprova.txt", GENERIC_WRITE, 0, NULL, CREATE_NEW,
                     FILE_ATTRIBUTE_NORMAL, NULL);
  bBuffer = "Scrivi qualcosa.";
  bytesdascrivere = (DWORD)strlen(bBuffer);
  bRet = WriteFile(hFile, bBuffer, bytesdascrivere, &dwWritten, NULL);
}
void scriviregistro(void) {
  PSECURITY_DESCRIPTOR secdesc = NULL;
  DWORD dwDisposition;
  SECURITY_ATTRIBUTES sa;
  LONG lRes;
  HKEY hkSub = NULL;
  sa.nLength = sizeof(SECURITY_ATTRIBUTES);
  sa.lpSecurityDescriptor = secdesc;
  sa.bInheritHandle = FALSE;
  char cName[] = "Provadiscrittura";
  HKEY hKey = HKEY_CURRENT_USER;
  lRes = RegCreateKeyEx(hKey, cName, 0, "", 0, KEY_ALL_ACCESS, &sa, &hkSub,
                        &dwDisposition);
}
void connetti(void) {
  WSADATA wsa;
  SOCKET s;
  struct sockaddr_in server;
  WSAStartup(MAKEWORD(2, 2), &wsa);
  s = socket(AF_INET, SOCK_STREAM, 0);
  server.sin_addr.s_addr = inet_addr("74.125.235.20");
  server.sin_family = AF_INET;
  server.sin_port = htons(80);
  connect(s, (struct sockaddr *)&server, sizeof(server));
  exit(0);
}
